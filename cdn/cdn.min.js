"use strict";var{keys:a,defineProperty:b}=Object,c=a=>typeof a=='number',d=a=>typeof a=='function',{isArray:e}=Array,f=this?.__extends||(function(){var A=function(d,b){A=Object.setPrototypeOf||(e({__proto__:[]})&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return A(d,b)};return function(d,b){if(!d(b)&&b!==null)throw TypeError(`Class extends value ${`${b}`} is not a constructor or null`);A(d,b);function _(){this.constructor=d}d.prototype=b==null?Object.create(b):(_.prototype=b.prototype,new _())}})(),g=this?.__assign||function(...args){g=Object.assign||function(t){for(var s,i=1,n=args.length;i<n;i++){s=args[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};return g.apply(this,args)},h=this?.__awaiter||function(A,_,P,B){function E(C){return C instanceof P?C:new P(function(_a){_a(C)})}return new (P||(P=Promise))(function(C,_b){function _c(_a){try {_e(B.next(_a))} catch (e) {_b(e)}}function D(_a){try {_e(B["throw"](_a))} catch (e) {_b(e)}}function _e(_a){_a.done?C(_a.value):E(_a.value).then(_c,D)}_e((B=B.apply(A,_||[])).next())})},i=this?.__generator||function(A,B){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return (g={next:H(0),"throw":H(1),"return":H(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g);function H(n){returnv=>I([n,v])}function I(C){if(f)throw TypeError("Generator is already executing.");while ((g&&(g=0,C[0]&&(_=0)),_))try {if((f=1,y&&(t=C[0]&2?y["return"]:C[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,C[1])).done))return t;(y=0,t)&&(C=[C[0]&2,t.value]);switch(C[0]) {case 0:case 1:t=C;break;case 4:_.label++;return{value:C[1],done:!1};case 5:_.label++;y=C[1];C=[0];continue;case 7:C=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(C[0]==6||C[0]==2)){_=0;continue}if(C[0]==3&&(!t||(C[1]>t[0]&&C[1]<t[3]))){_.label=C[1];break}if(C[0]==6&&_.label<t[1]){_.label=t[1];t=C;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(C);break}t[2]&&_.ops.pop();_.trys.pop();continue}C=B.call(A,_)} catch (e) {C=[6,e];y=0} finally {f=t=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},j=this?.__read||function(o,n){var m=typeof Symbol=="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,A=[],e;try {while ((n==void 0||n-->0)&&!(r=i.next()).done)A.push(r.value)} catch (_) {e={error:_}} finally {try {r&&!r.done&&(m=i["return"])&&m.call(i)} finally {if(e)throw e.error}}return A},k=this?.__values||function(o){var s=typeof Symbol=="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&c(o.length))return{next:function(){o&&i>=o.length&&(o=void 0);return{value:o?.[i++],done:!o}}};throw TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},m=function(A,_){typeof _=='string'&&(_=_.split('.'));var B=_.shift();if(B)return m(A[B],_);return A},n=function(A,_,B){typeof _=='string'&&(_=_.split('.'));var D=_.shift();D&&_.length>1?m(A[D],_):A[D]=B},o=function(A,_){var B={get:function(C,_b,_c){var D=Reflect.get(C,_b,_c);if(typeof D=='object'&&D!==null)return o(D,_);return D},set:function(C,_b,_c){n(C,_b,_c);_(A,C,_b,_c);return!0}};return new Proxy(A, B)},p=function(A,_,B){var D=document.querySelectorAll("[proxy_data=\"".concat(B,"\"]"));for(const C of D)C.textContent=m(A,C.getAttribute('proxy_data')||'')},q=(function(){function A(_){this.fields={};this.proxy=o({},p);this.form=_;this.init()}A.prototype.init=function(){var _=this,B=this.form.querySelectorAll('input[data-input]');for(const _a of B){var C=_a.getAttribute('name')||'_',D=_a.getAttribute('input-proxy');_.fields[C]=_a;D&&(_.proxy[D]=_a['value'],_a.addEventListener('input',function(){if(D)_.proxy[D]=_a['value']}))}};A.prototype.to_object=function(){var _={};for(const _A of Object.entries(this.fields)){var B=j(_A,2),C=B[0],D=B[1];_[C]=D['value']}return _};A.prototype.fetch=function(_,B,C,D){B==void 0&&(B={});C==void 0&&(C={});D==void 0&&(D={});return h(this,void 0,void 0,function(){var _a;return i(this,function(_A){switch(_A.label) {case 0:return[4,fetch(_,g({method:'POST', mode:'cors', headers:g({"Content-Type":"application/json"},B), body:JSON.stringify(g(g({},this.to_object()),C))},D))];case 1:_A=_A.sent();return[2,_A]}})})};A.prototype.reset=function(){for(const _ of Object.values(this.fields))_['value']=''};return A})(),r=(function(){function A(_){this.carbee_table=_;this.table=_.querySelector('table');this.init()}A.prototype.init=function(){};A.prototype.find=function(_,B){var C=this.table.getElementsByTagName('tr');if(_>=0&&_<C.length){var D=C[_].getElementsByTagName('td');if(B>=0&&B<D.length)return D[B]}return null};A.prototype.get=function(_,B){var C=this.find(_,B);return C?C.textContent:null};A.prototype.set=function(_,B,C){var D=this.find(_,B);D&&(D.textContent=`${(C||'')}`)};A.prototype.add_column=function(_){var B=this.table.getElementsByTagName('tr');for(var i=0;i<B.length;i++){if(_&&!_.includes(i))continue;var D=document.createElement('td');B[i].appendChild(D)}};A.prototype.add_row=function(){var _=document.createElement('tr'),B=0;for(const _a of this.table.getElementsByTagName('tr')){var C=_a.getElementsByTagName('td');B=C.length>B?C.length:B}for(var i=0;i<B;i++){var E=document.createElement('td');_.appendChild(E)}this.table.appendChild(_)};A.prototype.get_headers=function(){var _=this.table.querySelector('tr');return _?[..._.querySelectorAll('th, td')].map(function(B){return B.textContent}):[]};A.prototype.to_object=function(){var _=[],B=[];for(const[_a,_b] of this.table.querySelectorAll('tr').entries()){_[_a]={};for(const[D,_B] of _b.querySelectorAll('th, td').entries()){!_a&&B.push(_B.textContent||'');var C=B[D]==void 0?"column_".concat(D):B[D];_[_a][C]=_B.textContent}}return _};A.prototype.from_object=function(_){this.clear_table();if(!_.length)return;var B=a(_[0]),C=_.length,D=document.createElement('tr');for(var i=0;i<B.length;i++){var F=document.createElement('th');F.textContent=B[i];D.appendChild(F)}this.table.appendChild(D);for(var i=0;i<C;i++){var G=_[i],H=document.createElement('tr');for(var j=0;j<B.length;j++){var J=document.createElement('td');J.textContent=G[B[j]];H.appendChild(J)}this.table.appendChild(H)}};A.prototype.clear_table=function(){while (this.table.firstChild)this.table.removeChild(this.table.firstChild)};return A})();b(exports,"__esModule",{value:!0});exports.CoreWorker=exports.HivecraftTable=exports.HivecraftForm=void 0;exports.HivecraftForm=q;exports.HivecraftTable=r;exports.CoreWorker=(function(A){f(_,A);function _(){return A.call(this)||this}_.prototype.set_imports=function(){var B=this,C=document.querySelectorAll('script[local]');for(const _a of C)B.ext.imports[_a.getAttribute('local')||'']=window[_a.getAttribute('package')||'']};_.prototype.set_refs=function(){var B=this,C=document.querySelectorAll('[ref]');for(const _a of C)B.data.refs[_a.getAttribute('ref')||'']=_a};_.prototype.set_forms=function(){var B=this,C=document.querySelectorAll('div[data-form]');for(const _a of C){var _c=_a.getAttribute('data-form')||'_',D=new q(_a);B.ext.form[_c]=D}};_.prototype.set_table=function(){var B=this,C=document.querySelectorAll('div[table]');for(const _a of C){var _c=_a.getAttribute('table')||'_',D=new r(_a);B.ext.table[_c]=D}};_.prototype.set_params=function(){var B,C;var _c=new URLSearchParams(window.location.search),D=_c.entries();try {for(var E=k(D),F=E.next();!F.done;F=E.next()){var G=j(F.value,2),H=G[0],I=G[1];this.data.params[`${H}`]=`${I}`}} catch (_a) {B={error:_a}} finally {try {F&&!F.done&&(C=E.return)&&C.call(E)} finally {if(B)throw B.error}}};_.prototype.init=function(){this.set_params();this.set_imports();this.set_refs();this.data.proxy=o(this.data.proxy,p);this.set_forms();this.set_table();return this};_.prototype.$on_event=function(B,C,_c){var D=this,E=document.querySelector(B);!this.tree[B]&&(this.tree[B]={});E==null||E==void 0?void 0:E.addEventListener(C,function(){_c({self:E,item:D.tree[B],data:D.data,ext:D.ext})})};return _})((function(){function A(){this.tree={};this.data={proxy:{},refs:{},params:{}};this.ext={form:{},table:{},imports:{}}}return A})());

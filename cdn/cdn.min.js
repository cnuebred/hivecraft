var{keys:a,defineProperty:b}=Object,{isArray:c}=Array,e=(A,_)=>{typeof _=='string'&&(_=_.split('.'));const B=_.shift();if(B)return e(A[B],_);return A},f=(A,_,B)=>{typeof _=='string'&&(_=_.split('.'));const d=_.shift();d&&_.length>1?e(A[d],_):A[d]=B},g=(A,_,B=!0)=>{const d={get:(C,_b,_c)=>{const D=Reflect.get(C,_b,_c);if(typeof _b=='string'&&_b.startsWith('__')&&_b.endsWith('__'))return D;if(typeof D=='object'&&D!==null)return g(D,_,B);!B&&_(A,C,_b,_c);return D},set:(C,_b,_c)=>{if(_b.startsWith('__')&&_b.endsWith('__'))return!0;if(typeof _c=='object'&&_c!==null){c(_c)&&(_c=_c.map((D,_B)=>{if(!D['__hc_parent_name__']&&typeof D=='object'&&D!==null)D['__hc_parent_name__']=`${`${_b}`}.${_B}`; else if(D['__hc_parent_name__'])D['__hc_parent_name__']=`${`${_b}`}.${_B}`;return D}));const _a=C['__hc_parent_name__']?`${C['__hc_parent_name__']}.${_b}`:_b;b(_c,'__hc_parent_name__',{value:_a,writable:!0})}f(C,_b,_c);_(A,C,_b,_c);return!0}};return new Proxy(A, d)},h=(A,_)=>{let B=_;A.__hc_parent_name__&&(B=`${A['__hc_parent_name__']}.${_}`);const d=document.querySelectorAll(`[proxy_data="${B}"]`);for(const C of d)C.textContent=e(A,_||'')},i=(A,_)=>{let B=_;A.__hc_parent_name__&&(B=`${A['__hc_parent_name__']}.${_}`);const d=document.querySelectorAll(`[proxy_attr$="${B}"]`);for(const C of d){const _a=C.getAttribute('proxy_attr'),[_b,_c]=_a.split(' ').find(item=>item.split(':')[1].endsWith(B))?.split(':');if(!_b||!_c)return;!C[`origin_proxy_${_b}`]&&(C[`origin_proxy_${_b}`]=C.getAttribute(_b));C.setAttribute(_b,C[`origin_proxy_${_b}`].replaceAll(`[[${B}]]`,e(A,_)))}},j=(A,_,B)=>{h(_,B);for(const C of A.form.querySelectorAll(`[input-proxy="${B}"]`))C['value']=e(_,C.getAttribute('input-proxy')||'')};class Tree{constructor(){this.tree={};this.data={pure:{},proxy:{},refs:{},params:{}};this.ext={form:{},table:{},templates:{}};this.imports={}}}class HivecraftTemplate{constructor(A,_){this.hooked=!1;this.contains_hooks=[];this.children={};this.events=[];this.hivecraft=_;this.base=A;this.proxy=this.hivecraft.data.proxy;this.template=this.get_template(this.base)}setup(){var A=this.base.getAttribute('hc-for'),[_,B]=A?.split(' for ');this.refer=_;this.proxy_name=B;for(const C of this.base.querySelectorAll('[hc-for]'))C.setAttribute('hc-for-child','');this.base.style.display='none'}render_all(){var A=this.proxy[this.proxy_name],_=Math.ceil(Math.random()*(10000-100)+100),B=this.template;if(!c(A))return;for(const[C,_b] of A.entries()){var _a=`${C}`+'_'+_+'_'+this.base.attributes[0].name+this.proxy_name;if(!document.querySelector(`hc-template[v="${this.base.attributes[0].name}"]`))this.create_single_template(B,_b,d=>{d.setAttribute('index',_a);!this.base.hasAttribute('hc-for-child')&&this.base.before(d)});else for(const[d,D] of document.querySelectorAll(`hc-template[v="${this.base.attributes[0].name}"]`).entries())this.create_single_template(B,_b,_A=>{_A.setAttribute('index',_a);_A.setAttribute('no',`${d}`);D.before(_A)})}for(const C of document.querySelectorAll(`[index*="${this.last_section}_${this.base.attributes[0].name+this.proxy_name}"]`))C.remove();this.last_section=_;for(const C of B.querySelectorAll('hc-template'))this.hivecraft.ext.templates[C.getAttribute('v')||'']?.render_all()}replace_in_template(A,_,B){B&&(A.innerHTML=_.innerHTML.replace(new RegExp(`\\[@\\[${this.refer}(\\.([\\s\\S]*?))?\\]\\]`, 'gm'),(_,_1,_2)=>typeof B=='object'?e(B,_2||''):B))}async set_template_event(A,_){if(!_.querySelector('[eve]'))return;for(const B of _.querySelectorAll('[eve]'))if(B['events_list'])for(const C of B['events_list'])for(const _a of A.querySelectorAll(C[1])){_a['events_list']=[...B['events_list']];var d=B['events_list'];for(const D of d){var _A=A.getAttribute('no')?`[no="${A.getAttribute('no')}"]`:'';this.hivecraft.$on_event(`[index="${A.getAttribute('index')}"]${_A} ${D[1]}`,D[0],D[2])}}}single_template(A,_,B){this.replace_in_template(A,_,B);this.set_template_event(A,_)}create_single_template(A,_,B){var d=A.cloneNode(!0);B&&B(d);this.single_template(d,A,_);return d}get_template(A){var _=this.create_single_template(A,null,B=>{B.querySelectorAll('[hc-for]').forEach(C=>{const _b=document.createElement('hc-template');_b.setAttribute('v',C.attributes[0].name);C.replaceWith(_b)});for(const C of A.querySelectorAll('[eve]'))B.querySelector(`[${C.attributes[0].name}]`)&&this.events.push(...C['events_list']);B.removeAttribute(B.attributes[0].name);B.removeAttribute('hc-for');B.removeAttribute('hc-for-child');B.removeAttribute('style')});return _}render(A,_){var B=this.proxy[this.proxy_name];if(!A||_=='length')this.render_all();else{var C=A.split('.').pop();if(!isNaN(+C)){var _a=B[+C],_b=document.querySelectorAll(`[index^="${C}_"][index$="${this.base.attributes[0].name+this.proxy_name}"]`);if(_b.length)for(const d of _b)this.single_template(d,this.template,_a)}}}}class HivecraftForm{constructor(A){this.fields={};this.proxy=g({},(_,B,C)=>{j(this,_,C);this.set_proxy_values(_,B,C)});this.form=A;this.init()}set_proxy_values(A,_,B){var d=this.form.querySelectorAll(`input[input-proxy="${B}"],textarea[input-proxy="${B}"]`);for(const C of d)C['value']=e(_,B)}init(){var A=this.form.querySelectorAll('input[data-input],textarea[data-input]');for(const _ of A){var B=_.getAttribute('name')||'_',C=_.getAttribute('input-proxy');_.getAttribute('value')&&(_['value']=_.getAttribute('value'));this.fields[B]=_;C&&(this.proxy[C]=_['value'],_.addEventListener('input',()=>{var _a=_.getAttribute('input-proxy');if(_a)this.proxy[_a]=_['value']}))}}to_object(){var A={};for(let _ in this.fields)A[_]=this.fields[_]['value'];return A}async fetch(A,_={},B={},d={}){var E=await fetch(A,{method:'POST',mode:'cors',headers:{'Content-Type':'application/json',..._},body:JSON.stringify({...this.to_object(),...B}),...d});return E}reset(){for(const A of Object.values(this.fields))A['value']=''}}class HivecraftTable{constructor(A){this.carbee_table=A;this.table=A.querySelector('table');this.init()}init(){}find(A,_){var B=this.table.getElementsByTagName('tr');if(A>=0&&A<B.length){var C=B[A].getElementsByTagName('td');if(_>=0&&_<C.length)return C[_]}return null}get(A,_){var B=this.find(A,_);return B?B.textContent:null}set(A,_,B){var d=this.find(A,_);d&&(d.textContent=`${(B||'')}`)}add_column(A){var _=this.table.getElementsByTagName('tr');for(let i=0;i<_.length;i++){if(A&&!A.includes(i))continue;var B=document.createElement('td');_[i].appendChild(B)}}add_row(){var A=document.createElement('tr');let _=0;for(const B of this.table.getElementsByTagName('tr')){var C=B.getElementsByTagName('td');_=C.length>_?C.length:_}for(let i=0;i<_;i++){var B=document.createElement('td');A.appendChild(B)}this.table.appendChild(A)}get_headers(){var A=this.table.querySelector('tr');return A?[...A.querySelectorAll('th, td')].map(cell=>cell.textContent):[]}to_object(){var A=[],_=[];for(const[B,C] of this.table.querySelectorAll('tr').entries()){A[B]={};for(const[_a,_b] of C.querySelectorAll('th, td').entries()){!B&&_.push(_b.textContent||'');var d=_[_a]==void 0?`column_${_a}`:_[_a];A[B][d]=_b.textContent}}return A}from_object(A){this.clear_table();if(!A.length)return;var _=a(A[0]),B=document.createElement('tr');for(let i=0;i<_.length;i++){var C=document.createElement('th');C.textContent=_[i];B.appendChild(C)}this.table.appendChild(B);for(const _a of A){var d=document.createElement('tr');for(let j=0;j<_.length;j++){var D=document.createElement('td');D.textContent=_a[_[j]];d.appendChild(D)}this.table.appendChild(d)}}clear_table(){while (this.table.firstChild)this.table.removeChild(this.table.firstChild)}}export class CoreWorker extends Tree{constructor(){super();this.render_cog=A=>{var _=document.querySelectorAll(A),B={self:_,item:this.tree[A],data:this.data,ext:this.ext,imports:this.imports};!this.tree[A]&&(this.tree[A]={});return B};this.proxy_callback_render_list=(A,_)=>{for(const B in this.ext.templates){var C=this.ext.templates[B];(C.proxy_name==_||A['__hc_parent_name__']?.startsWith(C.proxy_name))&&C.render(A['__hc_parent_name__'],_)}};this.proxy_callback=(A,_,B)=>{this.proxy_callback_render_list(A,B);h(A,B);i(A,B);this.set_conditions()}}set_conditions(){var A=document.querySelectorAll('[hc-if]');for(const _ of A){var B=_.getAttribute('hc-if'),C=`hc-if_${B}`,_c=this.data.pure[C],d=!_c?this.data.proxy[C]:_c(this.render_cog(`[${B}]`));d!=null&&_.style.setProperty('display',d?'block':'none')}}set_imports(){var A=document.querySelectorAll('script[local]');for(const _ of A)this.imports[_.getAttribute('local')||'']=window[_.getAttribute('package')||'']}set_refs(){var A=document.querySelectorAll('[ref]');for(const _ of A)this.data.refs[_.getAttribute('ref')||'']=_}set_forms(){var A=document.querySelectorAll('div[data-form]');for(const _ of A){var B=_.getAttribute('data-form')||'_',C=new HivecraftForm(_);this.ext.form[B]=C}}set_templates(){var A=document.querySelectorAll('[hc-for]');for(const _ of A){var B=new HivecraftTemplate(_, this);B.setup();this.ext.templates[_.attributes[0].name]=B}}set_table(){var A=document.querySelectorAll('div[table]');for(const _ of A){var B=_.getAttribute('table')||'_',C=new HivecraftTable(_);this.ext.table[B]=C}}set_params(){var A=new URLSearchParams(window.location.search),_=A.entries();for(let[B,C] of _)this.data.params[`${B}`]=`${C}`}before_start(){this.set_params();this.set_imports();this.set_refs();this.data.proxy=g(this.data.proxy,this.proxy_callback);this.set_forms();this.set_table();return this}after_start(){this.set_conditions();this.set_templates();return this}$on_event(A,_,B,d=!0){var E=this.render_cog(A);E.self?.forEach(C=>{d&&(!C['events_list']&&(C['events_list']=[]),C['events_list'].push([_,A,B]));C['query']=A;C.setAttribute('eve','');C.addEventListener(_,eve=>B({...E,...{self:C}},eve))})}$pure(A,_,B){var d=this.render_cog(A);for(const C of d.self){C['query']=A;_.startsWith('onload_')&&B({...d,...{self:C}});_.startsWith('hc-if_')&&(this.data.proxy[_]=B({...d,...{self:C}}));this.data.pure[_.replace(/ /gm,'_')]=(...args)=>B({...d,...{self:C}},...args)}}$proxy(A,_,B){B&&(_=JSON.parse(_));this.data.proxy[A.replace(/ /gm,'_')]=_}}

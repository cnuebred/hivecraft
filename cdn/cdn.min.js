var{keys:a,assign:b}=Object,c=this?.__awaiter||function(A,_,P,d){function B(C){return C instanceof P?C:new P(function(_a){_a(C)})}return new (P||(P=Promise))(function(C,_b){function _c(_a){try {E(d.next(_a))} catch (e) {_b(e)}}function D(_a){try {E(d['throw'](_a))} catch (e) {_b(e)}}function E(_a){_a.done?C(_a.value):B(_a.value).then(_c,D)}E((d=d.apply(A,_||[])).next())})},e=(A,_)=>{typeof _=='string'&&(_=_.split('.'));const B=_.shift();if(B)return e(A[B],_);return A},f=(A,_,B)=>{typeof _=='string'&&(_=_.split('.'));const d=_.shift();d&&_.length>1?e(A[d],_):A[d]=B},g=(A,_)=>{const B={get:(C,_b,_c)=>{const d=Reflect.get(C,_b,_c);if(typeof d=='object'&&d!==null)return g(d,_);return d},set:(C,_b,_c)=>{f(C,_b,_c);_(A,C,_b,_c);return!0}};return new Proxy(A, B)},h=(A,_,B)=>{const d=document.querySelectorAll(`[proxy_data="${B}"]`);for(const C of d)C.textContent=e(A,C.getAttribute('proxy_data')||'')};class Tree{constructor(){this.tree={};this.data={proxy:{},refs:{},params:{}};this.ext={form:{},table:{},imports:{}}}}class HivecraftForm{constructor(A){this.fields={};this.proxy=g({},h);this.form=A;this.init()}init(){var A=this.form.querySelectorAll('input[data-input]');for(const _ of A){var B=_.getAttribute('name')||'_',C=_.getAttribute('input-proxy');this.fields[B]=_;C&&(this.proxy[C]=_['value'],_.addEventListener('input',()=>{if(C)this.proxy[C]=_['value']}))}}to_object(){var A={};for(let _ in this.fields)A[_]=this.fields[_]['value'];return A}fetch(A,_={},B={},d={}){return c(this,void 0,void 0,function*(){return yield fetch(A,b({method:'POST', mode:'cors', headers:Object.assign({'Content-Type':'application/json'},_), body:JSON.stringify(Object.assign(Object.assign({},this.to_object()),B))},d))})}reset(){for(const A of Object.values(this.fields))A['value']=''}}class HivecraftTable{constructor(A){this.carbee_table=A;this.table=A.querySelector('table');this.init()}init(){}find(A,_){var B=this.table.getElementsByTagName('tr');if(A>=0&&A<B.length){var C=B[A].getElementsByTagName('td');if(_>=0&&_<C.length)return C[_]}return null}get(A,_){var B=this.find(A,_);return B?B.textContent:null}set(A,_,B){var d=this.find(A,_);d&&(d.textContent=`${(B||'')}`)}add_column(A){var _=this.table.getElementsByTagName('tr');for(let i=0;i<_.length;i++){if(A&&!A.includes(i))continue;var B=document.createElement('td');_[i].appendChild(B)}}add_row(){var A=document.createElement('tr');let _=0;for(const B of this.table.getElementsByTagName('tr')){var C=B.getElementsByTagName('td');_=C.length>_?C.length:_}for(let i=0;i<_;i++){var B=document.createElement('td');A.appendChild(B)}this.table.appendChild(A)}get_headers(){var A=this.table.querySelector('tr');return A?[...A.querySelectorAll('th, td')].map(cell=>cell.textContent):[]}to_object(){var A=[],_=[];for(const[B,C] of this.table.querySelectorAll('tr').entries()){A[B]={};for(const[_a,_b] of C.querySelectorAll('th, td').entries()){!B&&_.push(_b.textContent||'');var d=_[_a]==void 0?`column_${_a}`:_[_a];A[B][d]=_b.textContent}}return A}from_object(A){this.clear_table();if(!A.length)return;var _=a(A[0]),B=document.createElement('tr');for(let i=0;i<_.length;i++){var C=document.createElement('th');C.textContent=_[i];B.appendChild(C)}this.table.appendChild(B);for(const _a of A){var d=document.createElement('tr');for(let j=0;j<_.length;j++){var D=document.createElement('td');D.textContent=_a[_[j]];d.appendChild(D)}this.table.appendChild(d)}}clear_table(){while (this.table.firstChild)this.table.removeChild(this.table.firstChild)}}export class CoreWorker extends Tree{constructor(){super()}set_imports(){var A=document.querySelectorAll('script[local]');for(const _ of A)this.ext.imports[_.getAttribute('local')||'']=window[_.getAttribute('package')||'']}set_refs(){var A=document.querySelectorAll('[ref]');for(const _ of A)this.data.refs[_.getAttribute('ref')||'']=_}set_forms(){var A=document.querySelectorAll('div[data-form]');for(const _ of A){var B=_.getAttribute('data-form')||'_',C=new HivecraftForm(_);this.ext.form[B]=C}}set_table(){var A=document.querySelectorAll('div[table]');for(const _ of A){var B=_.getAttribute('table')||'_',C=new HivecraftTable(_);this.ext.table[B]=C}}set_params(){var A=new URLSearchParams(window.location.search),_=A.entries();for(let[B,C] of _)this.data.params[`${B}`]=`${C}`}init(){this.set_params();this.set_imports();this.set_refs();this.data.proxy=g(this.data.proxy,h);this.set_forms();this.set_table();return this}$on_event(A,_,B){var d=document.querySelector(A);!this.tree[A]&&(this.tree[A]={});d==null||d==void 0?void 0:d.addEventListener(_,()=>B({self:d,item:this.tree[A],data:this.data,ext:this.ext}))}}

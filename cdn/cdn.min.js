var{keys:a}=Object,c=(A,b)=>{typeof b=='string'&&(b=b.split('.'));const _=b.shift();if(_)return c(A[_],b);return A},d=(A,b,_)=>{typeof b=='string'&&(b=b.split('.'));const B=b.shift();B&&b.length>1?c(A[B],b):A[B]=_},e=(A,b,_=!0)=>{const B={get:(C,_b,_c)=>{const D=Reflect.get(C,_b,_c);if(typeof D=='object'&&D!==null)return e(D,b,_);!_&&b(A,C,_b,_c);return D},set:(C,_b,_c)=>{d(C,_b,_c);b(A,C,_b,_c);return!0}};return new Proxy(A, B)},f=(A,b)=>{const _=document.querySelectorAll(`[proxy_data="${b}"]`);for(const B of _)B.textContent=c(A,B.getAttribute('proxy_data')||'')},g=(A,b,_)=>{f(b,_);for(const B of A.form.querySelectorAll(`[input-proxy="${_}"]`))B['value']=c(b,B.getAttribute('input-proxy')||'')};class Tree{constructor(){this.tree={};this.data={pure:{},proxy:{},refs:{},params:{}};this.ext={form:{},table:{}};this.imports={}}}class HivecraftForm{constructor(A){this.fields={};this.proxy=e({},(container,target,prop)=>g(this,container,prop));this.form=A;this.init()}init(){var A=this.form.querySelectorAll('input[data-input]');console.log(A);for(const _ of A){var b=_.getAttribute('name')||'_',B=_.getAttribute('input-proxy');this.fields[b]=_;B&&(this.proxy[B]=_['value'],_.addEventListener('input',()=>{if(B)this.proxy[B]=_['value']}))}}to_object(){var A={};for(let _ in this.fields)A[_]=this.fields[_]['value'];return A}async fetch(A,b={},_={},B={}){var E=await fetch(A,{method:'POST',mode:'cors',headers:{'Content-Type':'application/json',...b},body:JSON.stringify({...this.to_object(),..._}),...B});return E}reset(){for(const A of Object.values(this.fields))A['value']=''}}class HivecraftTable{constructor(A){this.carbee_table=A;this.table=A.querySelector('table');this.init()}init(){}find(A,b){var _=this.table.getElementsByTagName('tr');if(A>=0&&A<_.length){var B=_[A].getElementsByTagName('td');if(b>=0&&b<B.length)return B[b]}return null}get(A,b){var _=this.find(A,b);return _?_.textContent:null}set(A,b,_){var B=this.find(A,b);B&&(B.textContent=`${(_||'')}`)}add_column(A){var b=this.table.getElementsByTagName('tr');for(let i=0;i<b.length;i++){if(A&&!A.includes(i))continue;var _=document.createElement('td');b[i].appendChild(_)}}add_row(){var A=document.createElement('tr');let b=0;for(const _ of this.table.getElementsByTagName('tr')){var B=_.getElementsByTagName('td');b=B.length>b?B.length:b}for(let i=0;i<b;i++){var _=document.createElement('td');A.appendChild(_)}this.table.appendChild(A)}get_headers(){var A=this.table.querySelector('tr');return A?[...A.querySelectorAll('th, td')].map(cell=>cell.textContent):[]}to_object(){var A=[],b=[];for(const[_,B] of this.table.querySelectorAll('tr').entries()){A[_]={};for(const[C,_b] of B.querySelectorAll('th, td').entries()){!_&&b.push(_b.textContent||'');var _a=b[C]==void 0?`column_${C}`:b[C];A[_][_a]=_b.textContent}}return A}from_object(A){this.clear_table();if(!A.length)return;var b=a(A[0]),_=document.createElement('tr');for(let i=0;i<b.length;i++){var B=document.createElement('th');B.textContent=b[i];_.appendChild(B)}this.table.appendChild(_);for(const C of A){var _a=document.createElement('tr');for(let j=0;j<b.length;j++){var D=document.createElement('td');D.textContent=C[b[j]];_a.appendChild(D)}this.table.appendChild(_a)}}clear_table(){while (this.table.firstChild)this.table.removeChild(this.table.firstChild)}}export class CoreWorker extends Tree{constructor(){super();this.render_cog=A=>{var b=document.querySelector(A),_={self:b,item:this.tree[A],data:this.data,ext:this.ext,imports:this.imports};!this.tree[A]&&(this.tree[A]={});return _};this.proxy_callback=(A,b,_)=>{f(A,_);this.set_conditions()}}set_conditions(){var A=document.querySelectorAll('[hc-if]');for(const _ of A){var b=_.getAttribute('hc-if'),B=`hc-if_${b}`,C=this.data.pure[B];console.log(B,C);if(C){var _a=C(this.render_cog(`[${b}]`));_a!=null&&_.style.setProperty('display',_a?'block':'none')}}}set_imports(){var A=document.querySelectorAll('script[local]');for(const _ of A)this.imports[_.getAttribute('local')||'']=window[_.getAttribute('package')||'']}set_refs(){var A=document.querySelectorAll('[ref]');for(const _ of A)this.data.refs[_.getAttribute('ref')||'']=_}set_forms(){var A=document.querySelectorAll('div[data-form]');for(const _ of A){var b=_.getAttribute('data-form')||'_',B=new HivecraftForm(_);this.ext.form[b]=B}}set_table(){var A=document.querySelectorAll('div[table]');for(const _ of A){var b=_.getAttribute('table')||'_',B=new HivecraftTable(_);this.ext.table[b]=B}}set_params(){var A=new URLSearchParams(window.location.search),b=A.entries();for(let[_,B] of b)this.data.params[`${_}`]=`${B}`}before_start(){this.set_params();this.set_imports();this.set_refs();this.set_conditions();this.data.proxy=e(this.data.proxy,this.proxy_callback);this.set_forms();this.set_table();return this}after_start(){this.set_conditions();return this}$on_event(A,b,_){var B=this.render_cog(A);B.self?.addEventListener(b,()=>_(B))}$pure(A,b,_){var B=this.render_cog(A);b.startsWith('onload_')&&_(B);b.startsWith('hc-if_')&&(this.data.proxy[b]=_(B));this.data.pure[b.replace(/ /gm,'_')]=()=>_(B)}$proxy(A,b){this.data.proxy[A.replace(/ /gm,'_')]=b}}
